<!doctype html><html><head><title>Aplicacao CRUD Serverless com AWS CDK - Parte 2</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content="AWS CDK Parte 2"><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=https://lucassan.github.io/scss/journal.min.c5d92f380bf10f6849c7ac487c7df2b22c081e0851e5339224f1ae29210b20d2.css integrity="sha256-xdkvOAvxD2hJx6xIfH3ysiwIHghR5TOSJPGuKSELINI=" media=screen><link rel=stylesheet href=https://lucassan.github.io/scss/dark-mode.min.9f8d8c2df9285089d141edd4a50cb7506c7948e6ab79a29968dced1bd0ab7d22.css integrity="sha256-n42MLfkoUInRQe3UpQy3UGx5SOareaKZaNztG9CrfSI=" media=screen><script src=/vendor/js/loadCSS.js></script>
<script>loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons")</script><script src=/js/toc.js></script></head><body><div id=app><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://lucassan.github.io/><div class=nav-title>Lucas Santos</div></a><div class=nav-link-list></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
2022 Lucas Santos</div></div><div id=extraContainer class=extra-container><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#aplica%c3%a7%c3%a3o-crud-serverless-com-aws-cdk---parte-2 onclick="onNavClick(`#aplicação-crud-serverless-com-aws-cdk---parte-2-nav`)" id=aplicação-crud-serverless-com-aws-cdk---parte-2-nav>Aplicação CRUD Serverless com AWS CDK - Parte 2</a></li></ul></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a>
<a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#aplica%c3%a7%c3%a3o-crud-serverless-com-aws-cdk---parte-2 onclick="onNavClick(`#aplicação-crud-serverless-com-aws-cdk---parte-2-nav`)" id=aplicação-crud-serverless-com-aws-cdk---parte-2-nav>Aplicação CRUD Serverless com AWS CDK - Parte 2</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a id=navTitle class=navbar-brand href=https://lucassan.github.io/>Lucas Santos</a>
<button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://lucassan.github.io/><div class=single-column-header-title>Lucas Santos</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>Aplicacao CRUD Serverless com AWS CDK - Parte 2<div class=post-subtitle>AWS CDK Parte 2</div><div class=post-meta><time itemprop=datePublished>2022-07-24 14:50</time>
<i class=material-icons>label</i>
<a href=/tags/cdk>CDK</a>
&nbsp;</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h1 id=aplicação-crud-serverless-com-aws-cdk---parte-2>Aplicação CRUD Serverless com AWS CDK - Parte 2</h1><p>O objetivo será construir um CRUD através de uma arquitetura simples, onde criaremos um API Gateway, e pra cada verbo HTTP usado ao invocar o endpoint desse API Gateway, será chamada uma função lambda, e a função irá ter acesso a um banco de dados que também iremos criar.</p><p><img src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3f7e22f9-b2e7-4748-b319-da4152a801c7/Screenshot_2022-07-22_at_11.21.32.png alt="Screenshot 2022-07-22 at 11.21.32.png"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>Pré</span><span style=color:#f92672>-</span><span style=color:#a6e22e>requisitos</span>
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> <span style=color:#a6e22e>Aplicação</span> <span style=color:#a6e22e>CRUD</span> <span style=color:#a6e22e>Serverless</span> <span style=color:#a6e22e>com</span> <span style=color:#a6e22e>AWS</span> <span style=color:#a6e22e>CDK</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>Parte</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> <span style=color:#a6e22e>Ambiente</span> <span style=color:#a6e22e>aws</span> <span style=color:#a6e22e>configurado</span> (<span style=color:#a6e22e>aws</span> <span style=color:#a6e22e>configure</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> <span style=color:#a6e22e>Instalar</span> <span style=color:#a6e22e>o</span> <span style=color:#a6e22e>aws</span><span style=color:#f92672>-</span><span style=color:#a6e22e>cdk</span> <span style=color:#66d9ef>package</span> <span style=color:#a6e22e>com</span> <span style=color:#e6db74>`npm i aws-cdk`</span>
</span></span></code></pre></div><p>Então vamos abrir nosso terminal, no meu caso estou usando o iTerm2, e numa pasta de sua preferência onde iremos criar nosso projeto, iremos dar o comando</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>cdk</span> <span style=color:#a6e22e>init</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>language</span> <span style=color:#a6e22e>typescript</span>
</span></span></code></pre></div><p>esse comando irá criar toda uma estrutura básica pra funcionamento do nosso projeto, vamos abrir no Visual Studio pra vermos como ficou a estrutura criada</p><p>Então minha ideia aqui é criar uma pastinha chamada <code>lambda</code> e dentro dela vamos criar nossas funções lambdas que ficarão separadas em quatro arquivos.</p><p>Primeiro arquivo que vamos criar então dentro da pasta <code>lambda</code> será para criar orders, vamos dar o nome de <code>create-orders.js</code> e a princípio vamos deixar essa função o mais simples possível, depois a gente volta refatorando pra começar a dar mais responsabilidades a nossa função</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>main</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>event</span>, <span style=color:#a6e22e>context</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>statusCode</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>201</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;new register Yay!&#34;</span>,
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>bem simples, sempre irá retornar um status 201 (Created), com a mensagem “new register Yay!”</p><p>Agora vamos criar nossos próximos arquivos seguindo o mesmo modelo simples, e refatoramos depois pra adicionar funcionalidades a essas funções</p><p>Criar o arquivo <code>delete-orders.js</code> com código bem semelhante, todos eles na verdade terão um código semelhante, e depois refatoramos</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>main</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>event</span>, <span style=color:#a6e22e>context</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>statusCode</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;order deleted&#34;</span>,
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Agora vamos criar o arquivo <code>get-orders.js</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>main</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>event</span>, <span style=color:#a6e22e>context</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>statusCode</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;all orders here&#34;</span>,
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>e por fim, criaremos um último arquivo que irá conter a função de update, arquivo vamos chama-lo de <code>update-orders.js</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>main</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>event</span>, <span style=color:#a6e22e>context</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>statusCode</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;order updated&#34;</span>,
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Arquivos criados, funções criadas, e agora? próximo passo então será criar um arquivo dentro da pasta <code>lib</code>, e nesse arquivo vamos concentrar a lógica pra criar a arquitetura de nossa aplicação usando o AWS CDK</p><p>Então, vamos dar um nome ao nosso arquivo, vou colocar o nome de <code>order-service.ts</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrdersService</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Construct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>scope</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Construct</span>, <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>scope</span>, <span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>essa é a estrutura inicial de um <code>Construct</code> , então vamos fazer uma listinha do que precisamos fazer agora</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrdersService</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Construct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>scope</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Construct</span>, <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>scope</span>, <span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Registrar nossa lambda de buscar orders - GET
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 2. Registrar nossa lambda de criar orders - POST
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 3. Registrar nossa lambda de deletar orders - DELETE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 4. Registrar nossa lambda de atualizar orders - UPDATE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 5. Criar uma REST API Gateway
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 6. Associar cada verbo HTTP a sua respectiva função
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>com isso, vamos ao primeiro item da lista</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Code</span>, Function, <span style=color:#a6e22e>Runtime</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;aws-cdk-lib/aws-lambda&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrdersService</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Construct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>scope</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Construct</span>, <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>scope</span>, <span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Registrar nossa lambda de buscar orders - GET
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerGet</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;GetOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>), <span style=color:#75715e>// pasta onde esta as lambdas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;get-orders.main&#34;</span>, <span style=color:#75715e>// nome do arquivo.nome do metodo exportado
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Registrar nossa lambda de criar orders - POST
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 3. Registrar nossa lambda de deletar orders - DELETE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 4. Registrar nossa lambda de atualizar orders - UPDATE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 5. Criar uma REST API Gateway
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 6. Associar cada verbo HTTP a sua respectiva função
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Então vamos ver o que está acontecendo aqui, pra declarar ou registrar a função lambda que criamos ele vai pedir um, que é o mesmo que temos no nosso constructor no início da nossa classe, então vamos passar o <code>this</code> depois passamos um <code>id</code> pra nossa função e depois algumas props, que será <code>runtime, code e handler</code> (há muitas outras props que podemos passar aqui, mas vou trabalhar com essas 3 apenas, pra manter o código num cenário simples.</p><p>O <code>runtime</code> é a versão do ambiente, do node, na qual você irá fazer o upload dessa função pro ambiente da AWS, já o <code>code</code> é simplesmente a pasta onde colocamos nossas funções lambda, no nosso caso foi na pastinha que demos o nome de <code>lambda</code>, e o <code>handler</code> onde iremos informar o nome do arquivo e o nome do método exportado no arquivo.</p><p>Agora vamos registrar as outras funções lambdas que criamos</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrdersService</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Construct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>scope</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Construct</span>, <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>scope</span>, <span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Registrar nossa lambda de buscar orders - GET
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerGet</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;GetOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>), <span style=color:#75715e>// pasta onde esta as lambdas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;get-orders.main&#34;</span>, <span style=color:#75715e>// nome do arquivo.nome do metodo exportado
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Registrar nossa lambda de criar orders - POST
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerPost</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;CreateOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;create-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Registrar nossa lambda de deletar orders - DELETE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerDelete</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;DeleteOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;delete-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. Registrar nossa lambda de atualizar orders - UPDATE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerUpdate</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;UpdateOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;update-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. Criar uma REST API Gateway
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 6. Associar cada verbo HTTP a sua respectiva função
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Bom, registramos nossas lambdas no nosso constructor, mas ainda não temos um API Gateway, e também não associamos os verbos HTTP a sua respectiva função, como por exemplo, o GET tem que chamar a meu lambda responsável por buscar as orders, certo?</p><p>Então vamos para o passo 5, que é criar um API Gateway</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrdersService</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Construct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>scope</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Construct</span>, <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>scope</span>, <span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Registrar nossa lambda de buscar orders - GET
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerGet</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;GetOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>), <span style=color:#75715e>// pasta onde esta as lambdas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;get-orders.main&#34;</span>, <span style=color:#75715e>// nome do arquivo.nome do metodo exportado
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Registrar nossa lambda de criar orders - POST
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerPost</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;CreateOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;create-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Registrar nossa lambda de deletar orders - DELETE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerDelete</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;DeleteOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;delete-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. Registrar nossa lambda de atualizar orders - UPDATE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerUpdate</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;UpdateOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;update-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. Criar uma REST API Gateway
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RestApi</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;orders-api&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>restApiName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OrdersService&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>description</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;REST API Gateway pra Orders&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 6. Associar cada verbo HTTP a sua respectiva função
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>API Gateway criada, setamos um <code>restApiName</code> e uma <code>description</code> a ela, vamos agora associar os métodos <code>GET</code>, <code>POST</code>, <code>DELETE</code> e <code>PUT</code> a uma função lambda que já criamos</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrdersService</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Construct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>scope</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Construct</span>, <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>scope</span>, <span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Registrar nossa lambda de buscar orders - GET
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerGet</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;GetOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>), <span style=color:#75715e>// pasta onde esta as lambdas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;get-orders.main&#34;</span>, <span style=color:#75715e>// nome do arquivo.nome do metodo exportado
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Registrar nossa lambda de criar orders - POST
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerPost</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;CreateOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;create-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Registrar nossa lambda de deletar orders - DELETE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerDelete</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;DeleteOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;delete-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. Registrar nossa lambda de atualizar orders - UPDATE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerUpdate</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;UpdateOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;update-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. Criar uma REST API Gateway
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RestApi</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;orders-api&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>restApiName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OrdersService&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>description</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;REST API Gateway pra Orders&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 6. Associar cada verbo HTTP a sua respectiva função
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>root</span>.<span style=color:#a6e22e>addMethod</span>(<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#a6e22e>handlerGet</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Podemos ver um erro,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>Argument</span> <span style=color:#a6e22e>type</span> <span style=color:#e6db74>&#39;Function&#39;</span> <span style=color:#a6e22e>is</span> <span style=color:#a6e22e>not</span> <span style=color:#a6e22e>assingable</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>parameter</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>type</span> <span style=color:#e6db74>&#39;Integration&#39;</span>
</span></span></code></pre></div><p>em outras palavras, ele esperava um parâmetro do tipo <code>Integration</code> e eu passei uma função que criamos logo acima, então por isso ele fala “opa espera aí, você me passou uma função e eu espero receber uma integration”, e isso faz sentido, pois ao abrir o Console da AWS, na parte de API Gateway, vou pegar um aqui que já tenho, existe um passo chamado Integration Request e depois sim vem o Lambda Function.</p><p><img src=https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b88b675a-1550-4fb5-8085-0a8e76f97293/Screenshot_2022-07-23_at_16.55.15.png alt="Screenshot 2022-07-23 at 16.55.15.png"></p><p>então vamos criar essa integration que ele pede, vou adicionar um novo passo no nosso código</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrdersService</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Construct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>scope</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Construct</span>, <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>scope</span>, <span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Registrar nossa lambda de buscar orders - GET
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerGet</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;GetOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>), <span style=color:#75715e>// pasta onde esta as lambdas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;get-orders.main&#34;</span>, <span style=color:#75715e>// nome do arquivo.nome do metodo exportado
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Registrar nossa lambda de criar orders - POST
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerPost</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;CreateOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;create-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Registrar nossa lambda de deletar orders - DELETE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerDelete</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;DeleteOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;delete-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. Registrar nossa lambda de atualizar orders - UPDATE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handlerUpdate</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Function(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;UpdateOrdersHandler&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>runtime</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Runtime</span>.<span style=color:#a6e22e>NODEJS_14_X</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>code</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Code</span>.<span style=color:#a6e22e>fromAsset</span>(<span style=color:#e6db74>&#34;lambda&#34;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;update-orders.main&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. Criar uma REST API Gateway
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RestApi</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#34;orders-api&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>restApiName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;OrdersService&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>description</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;REST API Gateway pra Orders&#34;</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 6. Integration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getOrdersIntegration</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>LambdaIntegration</span>(<span style=color:#a6e22e>handlerGet</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>postOrdersIntegration</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>LambdaIntegration</span>(<span style=color:#a6e22e>handlerPost</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>deleteOrdersIntegration</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>LambdaIntegration</span>(<span style=color:#a6e22e>handlerDelete</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>updateOrdersIntegration</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>LambdaIntegration</span>(<span style=color:#a6e22e>handlerUpdate</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 7. Associar cada verbo HTTP a sua respectiva função
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>root</span>.<span style=color:#a6e22e>addMethod</span>(<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#a6e22e>getOrdersIntegration</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>root</span>.<span style=color:#a6e22e>addMethod</span>(<span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#a6e22e>postOrdersIntegration</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>root</span>.<span style=color:#a6e22e>addMethod</span>(<span style=color:#e6db74>&#34;DELETE&#34;</span>, <span style=color:#a6e22e>deleteOrdersIntegration</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>root</span>.<span style=color:#a6e22e>addMethod</span>(<span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#a6e22e>updateOrdersIntegration</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>com isso, terminamos por agora de criar, registrar e associar as funções lambdas à API Gateway, e vamos fazer um deploy do que fizemos pra ver como fica na AWS, pra fazer o deploy basta executar o comando</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>cdk</span> <span style=color:#a6e22e>deploy</span>
</span></span></code></pre></div><hr width=100% id=EOF><p style=color:#777>Last modified on 2022-07-24</p></div></div><nav class=post-pagination><a class=newer-posts>Next<br>No newer posts.</a>
<a class=older-posts href=https://lucassan.github.io/2021-06-26-event-driven/>Previous<br>The One with Event-Driven Architecture</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
2022 Lucas Santos</div></div><script src=/js/journal.js></script></body></html>